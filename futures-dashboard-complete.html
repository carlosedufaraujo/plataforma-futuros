<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Contratos Futuros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Variáveis de tema */
        :root {
            /* Modo Escuro (padrão) */
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #141414;
            --bg-hover: #252525;
            --border-color: #2a2a2a;
            --text-primary: #e0e0e0;
            --text-secondary: #888888;
            --text-bright: #ffffff;
            --sidebar-width: 280px;
            
            /* Cores semânticas */
            --color-positive: #10b981;
            --color-negative: #ef4444;
            --color-neutral: #6b7280;
            --color-info: #3b82f6;
            --color-warning: #f59e0b;
            --color-positive-bg: #10b98120;
            --color-negative-bg: #ef444420;
            --color-info-bg: #3b82f620;
            --color-warning-bg: #f59e0b20;
            
            /* Gradientes */
            --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            --gradient-positive: linear-gradient(135deg, #10b981 0%, #059862 100%);
            --gradient-negative: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* Modo Claro */
        [data-theme="light"] {
            --bg-primary: #EEECE8;
            --bg-secondary: #ffffff;
            --bg-tertiary: #fafaf9;
            --bg-hover: #f5f3f0;
            --border-color: #e0ddd8;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-bright: #000000;
            
            --color-positive: #059862;
            --color-negative: #dc2626;
            --color-neutral: #4b5563;
            --color-info: #2563eb;
            --color-warning: #d97706;
            --color-positive-bg: #05986215;
            --color-negative-bg: #dc262615;
            --color-info-bg: #2563eb15;
            --color-warning-bg: #d9770615;
            
            --gradient-primary: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            --gradient-positive: linear-gradient(135deg, #059862 0%, #047857 100%);
            --gradient-negative: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }
        
        /* Layout Principal */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Enhanced */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 24px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-bright);
        }
        
        /* Quick Stats no Sidebar */
        .sidebar-stats {
            padding: 16px;
            background: var(--bg-hover);
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 13px;
        }
        
        .stat-label {
            color: var(--text-secondary);
        }
        
        .stat-value {
            font-weight: 600;
            color: var(--text-bright);
        }
        
        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
            position: relative;
        }
        
        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background: var(--bg-hover);
            color: var(--text-bright);
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--color-info);
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 24px;
            max-width: calc(100vw - var(--sidebar-width));
        }
        
        .page-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-bright);
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        /* Theme Toggle Enhanced */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            border-color: var(--text-secondary);
        }
        
        .theme-option {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .theme-option.active {
            background: var(--color-info);
            color: white;
        }
        
        .theme-option i {
            width: 16px;
            height: 16px;
        }
        
        /* Páginas */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Cards e Grids Enhanced */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .metric-card:hover::before {
            opacity: 1;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        
        [data-theme="light"] .metric-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.06);
        }
        
        .metric-icon {
            width: 40px;
            height: 40px;
            background: var(--color-info-bg);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            color: var(--color-info);
        }
        
        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-bright);
        }
        
        .metric-change {
            font-size: 14px;
            margin-top: 5px;
        }
        
        .positive {
            color: var(--color-positive);
        }
        
        .negative {
            color: var(--color-negative);
        }
        
        .neutral {
            color: var(--color-neutral);
        }
        
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .card h2 {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 20px;
            color: var(--text-bright);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Tabelas Enhanced */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }
        
        .data-table tr:hover {
            background: var(--bg-hover);
        }
        
        /* Badges Enhanced */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: var(--color-positive-bg);
            color: var(--color-positive);
        }
        
        .badge-danger {
            background: var(--color-negative-bg);
            color: var(--color-negative);
        }
        
        .badge-info {
            background: var(--color-info-bg);
            color: var(--color-info);
        }
        
        .badge-warning {
            background: var(--color-warning-bg);
            color: var(--color-warning);
        }
        
        /* Gráficos */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(4px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 500;
            color: var(--text-bright);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Formulários Enhanced */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--color-info);
            box-shadow: 0 0 0 3px var(--color-info-bg);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn i {
            width: 16px;
            height: 16px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
        }
        
        .btn-success {
            background: var(--gradient-positive);
            color: white;
        }
        
        .btn-danger {
            background: var(--gradient-negative);
            color: white;
        }
        
        /* Tabs Enhanced */
        .tabs {
            display: flex;
            gap: 24px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
        }
        
        .tab {
            padding: 12px 0;
            color: var(--text-secondary);
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        
        .tab:hover {
            color: var(--text-primary);
        }
        
        .tab.active {
            color: var(--color-info);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-info);
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .quick-action {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--text-primary);
        }
        
        .quick-action:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }
        
        .quick-action-icon {
            width: 40px;
            height: 40px;
            background: var(--color-info-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-info);
        }
        
        .quick-action-text h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--text-bright);
        }
        
        .quick-action-text p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Options Page Specific */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .option-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .option-type {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-bright);
        }
        
        .option-details {
            display: grid;
            gap: 8px;
        }
        
        .option-detail {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }
        
        .option-detail-label {
            color: var(--text-secondary);
        }
        
        .option-detail-value {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        /* Responsive */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                max-width: 100vw;
                padding: 16px;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
            }
        }
        
        /* Overlay para mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        /* Position Summary Cards */
        .position-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .summary-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .summary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .summary-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-bright);
        }
        
        .summary-card-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .summary-metrics {
            display: grid;
            gap: 12px;
        }
        
        .summary-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .summary-metric-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .summary-metric-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Calculation Preview */
        .calculation-preview {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }
        
        .calculation-preview h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-bright);
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .preview-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }
        
        .preview-item .label {
            color: var(--text-secondary);
        }
        
        .preview-item .value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Direction indicators */
        .direction-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .direction-indicator.long::before {
            content: "↗";
            color: var(--color-positive);
        }
        
        .direction-indicator.short::before {
            content: "↘";
            color: var(--color-negative);
        }
        
        /* Payoff Chart */
        .payoff-container {
            height: 250px;
            position: relative;
            margin-top: 20px;
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        /* Status indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active {
            background: var(--color-positive);
        }
        
        .status-inactive {
            background: var(--color-neutral);
        }
        
        .status-warning {
            background: var(--color-warning);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar Enhanced -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                    </div>
                    <span class="logo-text">FuturesTrade Pro</span>
                </div>
                
                <!-- Quick Stats -->
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <span class="stat-label">Saldo Conta</span>
                        <span class="stat-value positive">R$ 250.450</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">P&L Hoje</span>
                        <span class="stat-value positive">+R$ 3.280</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Margem Livre</span>
                        <span class="stat-value">32%</span>
                    </div>
                </div>
            </div>
            
            <nav class="nav-menu">
                <a class="nav-item active" onclick="showPage('rentabilidade', this)">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    <span>Rentabilidade</span>
                </a>
                <a class="nav-item" onclick="showPage('posicoes', this)">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <span>Posições</span>
                </a>
                <a class="nav-item" onclick="showPage('opcoes', this)">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    <span>Opções</span>
                </a>
                <a class="nav-item" onclick="showPage('transacoes', this)">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                    <span>Transações</span>
                </a>
                <a class="nav-item" onclick="showPage('configuracoes', this)">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6m4.22-10.22l4.24 4.24M6.34 6.34L2.1 2.1m17.8 17.8l-4.24-4.24M17.66 17.66l4.24 4.24M2.1 21.9l4.24-4.24M6.34 17.66L2.1 21.9"></path>
                    </svg>
                    <span>Configurações</span>
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Página Rentabilidade -->
            <div id="rentabilidade" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Rentabilidade</h1>
                    <div class="header-actions">
                        <select class="form-control" style="width: auto;">
                            <option>Últimos 30 dias</option>
                            <option>Últimos 90 dias</option>
                            <option>Este ano</option>
                            <option>Todo período</option>
                        </select>
                        <div class="theme-toggle" onclick="toggleTheme()">
                            <div class="theme-option" id="darkMode">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <span>Escuro</span>
                            </div>
                            <div class="theme-option" id="lightMode">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                                <span>Claro</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Lucro/Prejuízo Total</div>
                        <div class="metric-value positive">R$ 45.780</div>
                        <div class="metric-change positive">+18.5% no período</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">ROI</div>
                        <div class="metric-value">22.3%</div>
                        <div class="metric-change positive">↑ 3.2% vs mês anterior</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Win Rate</div>
                        <div class="metric-value">68%</div>
                        <div class="metric-change neutral">34 ganhos / 16 perdas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Sharpe Ratio</div>
                        <div class="metric-value">1.85</div>
                        <div class="metric-change positive">Risco-retorno ótimo</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Drawdown Máximo</div>
                        <div class="metric-value negative">-12.5%</div>
                        <div class="metric-change">Em 15/06/2025</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Capital Investido</div>
                        <div class="metric-value">R$ 250.000</div>
                        <div class="metric-change neutral">Inicial: R$ 200.000</div>
                    </div>
                </div>
                
                <div class="chart-grid">
                    <div class="card">
                        <h2>Evolução do Capital</h2>
                        <div class="chart-container">
                            <canvas id="capitalEvolutionChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <h2>P&L por Contrato</h2>
                        <div class="chart-container">
                            <canvas id="plByContractChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Resumo Financeiro por Mês</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mês</th>
                                <th>Trades</th>
                                <th>Volume Total</th>
                                <th>P&L</th>
                                <th>ROI</th>
                                <th>Win Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Julho/2025</td>
                                <td>15</td>
                                <td>R$ 485.000</td>
                                <td class="positive">+R$ 12.450</td>
                                <td class="positive">+5.2%</td>
                                <td>73%</td>
                            </tr>
                            <tr>
                                <td>Junho/2025</td>
                                <td>22</td>
                                <td>R$ 620.000</td>
                                <td class="positive">+R$ 8.200</td>
                                <td class="positive">+3.4%</td>
                                <td>64%</td>
                            </tr>
                            <tr>
                                <td>Maio/2025</td>
                                <td>18</td>
                                <td>R$ 380.000</td>
                                <td class="negative">-R$ 4.500</td>
                                <td class="negative">-1.8%</td>
                                <td>44%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Página Posições -->
            <div id="posicoes" class="page">
                <div class="page-header">
                    <h1 class="page-title">Posições</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openNewPositionModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Nova Posição
                        </button>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="showPositionTab('gestao', this)">Gestão</div>
                    <div class="tab" onclick="showPositionTab('performance', this)">Performance</div>
                    <div class="tab" onclick="showPositionTab('historico', this)">Histórico</div>
                    <div class="tab" onclick="showPositionTab('resumo', this)">Resumo Visual</div>
                </div>
                
                <!-- Tab Gestão -->
                <div id="posicoes-gestao" class="position-tab active">
                    <div class="quick-actions">
                        <div class="quick-action" onclick="closeAllPositions()">
                            <div class="quick-action-text">
                                <h4>Fechar Todas</h4>
                                <p>Liquidar posições abertas</p>
                            </div>
                        </div>
                        <div class="quick-action" onclick="autoHedge()">
                            <div class="quick-action-text">
                                <h4>Hedge Automático</h4>
                                <p>Proteger posições</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2>Posições Abertas</h2>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Contrato</th>
                                    <th>Tipo</th>
                                    <th>Direção</th>
                                    <th>Quantidade</th>
                                    <th>Preço Entrada</th>
                                    <th>Preço Atual</th>
                                    <th>P&L</th>
                                    <th>Stops</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>BGIK25</strong></td>
                                    <td>Boi Gordo</td>
                                    <td><span class="badge badge-success direction-indicator long">LONG</span></td>
                                    <td>10</td>
                                    <td>R$ 330,00</td>
                                    <td>R$ 335,50</td>
                                    <td class="positive">+R$ 18.150</td>
                                    <td>
                                        <span style="font-size: 12px;">
                                            SL: 325,00<br>
                                            TP: 340,00
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-secondary btn-sm" onclick="editPosition('BGIK25')">Editar</button>
                                            <button class="btn btn-danger btn-sm" onclick="closePosition('BGIK25', 335.50)">Fechar</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>CCMN25</strong></td>
                                    <td>Milho</td>
                                    <td><span class="badge badge-danger direction-indicator short">SHORT</span></td>
                                    <td>15</td>
                                    <td>R$ 85,00</td>
                                    <td>R$ 86,20</td>
                                    <td class="negative">-R$ 8.100</td>
                                    <td>
                                        <span style="font-size: 12px;">
                                            SL: 88,00<br>
                                            TP: 82,00
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-secondary btn-sm" onclick="editPosition('CCMN25')">Editar</button>
                                            <button class="btn btn-danger btn-sm" onclick="closePosition('CCMN25', 86.20)">Fechar</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Tab Performance -->
                <div id="posicoes-performance" class="position-tab" style="display: none;">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">P&L Não Realizado</div>
                            <div class="metric-value positive">+R$ 16.650</div>
                            <div class="metric-change positive">+0.38% da exposição</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Melhor Posição</div>
                            <div class="metric-value">BGIK25</div>
                            <div class="metric-change positive">+R$ 18.150 (+1.67%)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Pior Posição</div>
                            <div class="metric-value">CCMN25</div>
                            <div class="metric-change negative">-R$ 8.100 (-1.20%)</div>
                        </div>
                    </div>
                    
                    <div class="chart-grid">
                        <div class="card">
                            <h2>Distribuição de Capital</h2>
                            <div class="chart-container">
                                <canvas id="capitalDistributionChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h2>P&L por Posição</h2>
                            <div class="chart-container">
                                <canvas id="positionPLChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Histórico -->
                <div id="posicoes-historico" class="position-tab" style="display: none;">
                    <div class="card">
                        <h2>Posições Liquidadas</h2>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data Fechamento</th>
                                    <th>Contrato</th>
                                    <th>Direção</th>
                                    <th>Duração</th>
                                    <th>Entrada</th>
                                    <th>Saída</th>
                                    <th>P&L Final</th>
                                    <th>ROI</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>18/07/2025 14:30</td>
                                    <td><strong>BGIG25</strong></td>
                                    <td><span class="badge badge-success direction-indicator long">LONG</span></td>
                                    <td>5 dias</td>
                                    <td>R$ 318,00</td>
                                    <td>R$ 322,50</td>
                                    <td class="positive">+R$ 7.425</td>
                                    <td class="positive">+1.4%</td>
                                </tr>
                                <tr>
                                    <td>15/07/2025 11:15</td>
                                    <td><strong>CCMK25</strong></td>
                                    <td><span class="badge badge-danger direction-indicator short">SHORT</span></td>
                                    <td>12 dias</td>
                                    <td>R$ 84,50</td>
                                    <td>R$ 83,70</td>
                                    <td class="positive">+R$ 3.600</td>
                                    <td class="positive">+0.95%</td>
                                </tr>
                                <tr>
                                    <td>10/07/2025 09:45</td>
                                    <td><strong>BGIZ25</strong></td>
                                    <td><span class="badge badge-success direction-indicator long">LONG</span></td>
                                    <td>3 dias</td>
                                    <td>R$ 340,00</td>
                                    <td>R$ 338,00</td>
                                    <td class="negative">-R$ 3.300</td>
                                    <td class="negative">-0.59%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="card">
                        <h2>Evolução de Resultados</h2>
                        <div class="chart-container">
                            <canvas id="closedPositionsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Resumo Visual -->
                <div id="posicoes-resumo" class="position-tab" style="display: none;">
                    <div class="position-summary-grid">
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3 class="summary-card-title">BGI - Boi Gordo</h3>
                                <span class="badge badge-success">3 LONG</span>
                            </div>
                            <div class="summary-metrics">
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Exposição Total</span>
                                    <span class="summary-metric-value">R$ 3.267.000</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Preço Médio</span>
                                    <span class="summary-metric-value">R$ 332,25</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">P&L Total</span>
                                    <span class="summary-metric-value positive">+R$ 24.750</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Quantidade Total</span>
                                    <span class="summary-metric-value">9.900 arrobas</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3 class="summary-card-title">CCM - Milho</h3>
                                <span class="badge badge-danger">2 SHORT</span>
                            </div>
                            <div class="summary-metrics">
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Exposição Total</span>
                                    <span class="summary-metric-value">R$ 1.147.500</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Preço Médio</span>
                                    <span class="summary-metric-value">R$ 85,00</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">P&L Total</span>
                                    <span class="summary-metric-value negative">-R$ 8.100</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Quantidade Total</span>
                                    <span class="summary-metric-value">13.500 sacos</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3 class="summary-card-title">Resumo Geral</h3>
                                <span class="badge badge-info">5 Posições</span>
                            </div>
                            <div class="summary-metrics">
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Exposição Total</span>
                                    <span class="summary-metric-value">R$ 4.414.500</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">P&L Líquido</span>
                                    <span class="summary-metric-value positive">+R$ 16.650</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">ROI</span>
                                    <span class="summary-metric-value positive">+0,38%</span>
                                </div>
                                <div class="summary-metric">
                                    <span class="summary-metric-label">Long vs Short</span>
                                    <span class="summary-metric-value">3 × 2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2>Análise Comparativa</h2>
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="contractComparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Página Opções -->
            <div id="opcoes" class="page">
                <div class="page-header">
                    <h1 class="page-title">Opções e Hedge</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openNewOptionModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Nova Opção
                        </button>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="showOptionTab('posicoes', this)">Posições</div>
                    <div class="tab" onclick="showOptionTab('estrategias', this)">Estratégias</div>
                    <div class="tab" onclick="showOptionTab('payoff', this)">Payoff</div>
                </div>
                
                <!-- Tab Posições de Opções -->
                <div id="opcoes-posicoes" class="option-tab active">
                    <div class="options-grid">
                        <div class="option-card">
                            <div class="option-header">
                                <span class="option-type">CALL BGIK25</span>
                                <span class="badge badge-success">COMPRADA</span>
                            </div>
                            <div class="option-details">
                                <div class="option-detail">
                                    <span class="option-detail-label">Strike</span>
                                    <span class="option-detail-value">R$ 340,00</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">Prêmio</span>
                                    <span class="option-detail-value">R$ 2,50</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">Expiração</span>
                                    <span class="option-detail-value">30/05/2025</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">Delta</span>
                                    <span class="option-detail-value">0.45</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">P&L</span>
                                    <span class="option-detail-value positive">+R$ 825</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="option-card">
                            <div class="option-header">
                                <span class="option-type">PUT CCMN25</span>
                                <span class="badge badge-danger">VENDIDA</span>
                            </div>
                            <div class="option-details">
                                <div class="option-detail">
                                    <span class="option-detail-label">Strike</span>
                                    <span class="option-detail-value">R$ 82,00</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">Prêmio</span>
                                    <span class="option-detail-value">R$ 1,80</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">Expiração</span>
                                    <span class="option-detail-value">30/07/2025</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">Delta</span>
                                    <span class="option-detail-value">-0.32</span>
                                </div>
                                <div class="option-detail">
                                    <span class="option-detail-label">P&L</span>
                                    <span class="option-detail-value negative">-R$ 450</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Estratégias -->
                <div id="opcoes-estrategias" class="option-tab" style="display: none;">
                    <div class="card">
                        <h2>Estratégias Ativas</h2>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Estratégia</th>
                                    <th>Ativo</th>
                                    <th>Componentes</th>
                                    <th>Custo</th>
                                    <th>Max Lucro</th>
                                    <th>Max Perda</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Bull Call Spread</strong></td>
                                    <td>BGIK25</td>
                                    <td>
                                        <small>
                                            +1 Call 330<br>
                                            -1 Call 340
                                        </small>
                                    </td>
                                    <td>R$ 1.250</td>
                                    <td class="positive">R$ 3.300</td>
                                    <td class="negative">R$ 1.250</td>
                                    <td><span class="badge badge-success">Ativo</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Protective Put</strong></td>
                                    <td>CCMN25</td>
                                    <td>
                                        <small>
                                            +10 Futuros<br>
                                            +10 Put 84
                                        </small>
                                    </td>
                                    <td>R$ 4.050</td>
                                    <td class="positive">Ilimitado</td>
                                    <td class="negative">R$ 4.050</td>
                                    <td><span class="badge badge-success">Ativo</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Tab Payoff -->
                <div id="opcoes-payoff" class="option-tab" style="display: none;">
                    <div class="card">
                        <h2>Diagrama de Payoff</h2>
                        <div class="payoff-container">
                            <canvas id="payoffChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Página Transações -->
            <div id="transacoes" class="page">
                <div class="page-header">
                    <h1 class="page-title">Transações</h1>
                    <div class="header-actions">
                        <input type="date" class="form-control" style="width: auto;">
                        <span style="margin: 0 10px;">até</span>
                        <input type="date" class="form-control" style="width: auto;">
                        <button class="btn btn-secondary">
                            Filtrar
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Histórico de Transações</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Tipo</th>
                                <th>Contrato</th>
                                <th>Qtd</th>
                                <th>Preço</th>
                                <th>Total</th>
                                <th>Taxa</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>19/07/2025 15:45:23</td>
                                <td><span class="badge badge-success">COMPRA</span></td>
                                <td><strong>BGIK25</strong></td>
                                <td>5</td>
                                <td>R$ 335,50</td>
                                <td>R$ 552.825</td>
                                <td>R$ 12,50</td>
                                <td><span class="badge badge-info">Executada</span></td>
                            </tr>
                            <tr>
                                <td>19/07/2025 14:32:10</td>
                                <td><span class="badge badge-danger">VENDA</span></td>
                                <td><strong>CCMN25</strong></td>
                                <td>10</td>
                                <td>R$ 86,20</td>
                                <td>R$ 387.900</td>
                                <td>R$ 8,75</td>
                                <td><span class="badge badge-info">Executada</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Página Configurações -->
            <div id="configuracoes" class="page">
                <div class="page-header">
                    <h1 class="page-title">Configurações</h1>
                </div>
                
                <div class="card">
                    <h2>Conexão API - Preços em Tempo Real</h2>
                    <div class="form-group">
                        <label class="form-label">Status da Conexão</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="status-indicator status-active"></span>
                            <span>Conectado - B3 Market Data</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL da API</label>
                        <input type="text" class="form-control" value="wss://api.b3.com.br/marketdata/v1">
                    </div>
                    <button class="btn btn-primary">Testar Conexão</button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal Nova Posição -->
    <div class="modal" id="newPositionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Posição</h3>
                <button class="modal-close" onclick="closeModal('newPositionModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form onsubmit="handleNewPosition(event)">
                    <div class="form-group">
                        <label class="form-label">Tipo de Contrato</label>
                        <select class="form-control" id="contractType" onchange="updatePositionPreview()">
                            <option value="BGI">BGI - Boi Gordo (330 arrobas)</option>
                            <option value="CCM">CCM - Milho (450 sacos)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Vencimento</label>
                            <select class="form-control" id="contractMonth">
                                <option value="K">K - Maio/2025</option>
                                <option value="M">M - Junho/2025</option>
                                <option value="N">N - Julho/2025</option>
                                <option value="U">U - Setembro/2025</option>
                                <option value="V">V - Outubro/2025</option>
                                <option value="Z">Z - Dezembro/2025</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Direção</label>
                            <select class="form-control" id="direction" onchange="updatePositionPreview()">
                                <option value="LONG">LONG (Compra) ↗</option>
                                <option value="SHORT">SHORT (Venda) ↘</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Quantidade de Contratos</label>
                            <input type="number" class="form-control" id="quantity" placeholder="0" min="1" value="1" onchange="updatePositionPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Preço de Entrada</label>
                            <input type="text" class="form-control" id="price" placeholder="R$ 0,00" onkeyup="updatePositionPreview()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Stop Loss (opcional)</label>
                            <input type="text" class="form-control" id="stopLoss" placeholder="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Take Profit (opcional)</label>
                            <input type="text" class="form-control" id="takeProfit" placeholder="R$ 0,00">
                        </div>
                    </div>
                    
                    <!-- Preview de Cálculos -->
                    <div id="positionPreview" class="calculation-preview" style="display: none;">
                        <h4>Preview da Operação</h4>
                        <div class="preview-grid">
                            <div class="preview-item">
                                <span class="label">Quantidade Total:</span>
                                <span class="value" id="previewQuantity">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Exposição Total:</span>
                                <span class="value" id="previewExposure">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Lucro se <span id="profitDirection">-</span>:</span>
                                <span class="value positive" id="previewProfit">-</span>
                            </div>
                            <div class="preview-item">
                                <span class="label">Prejuízo se <span id="lossDirection">-</span>:</span>
                                <span class="value negative" id="previewLoss">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('newPositionModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">
                            <span id="submitButtonText">Confirmar Posição</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Nova Opção -->
    <div class="modal" id="newOptionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Opção</h3>
                <button class="modal-close" onclick="closeModal('newOptionModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tipo</label>
                                                        <select class="form-control">
                                <option>Call</option>
                                <option>Put</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ativo Base</label>
                            <select class="form-control">
                                <option>BGI - Boi Gordo</option>
                                <option>CCM - Milho</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Strike</label>
                            <input type="text" class="form-control" placeholder="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Prêmio</label>
                            <input type="text" class="form-control" placeholder="R$ 0,00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data de Expiração</label>
                            <input type="date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Delta</label>
                            <input type="text" class="form-control" placeholder="0.00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estratégia</label>
                        <select class="form-control">
                            <option>Simples</option>
                            <option>Spread</option>
                            <option>Straddle</option>
                            <option>Strangle</option>
                            <option>Butterfly</option>
                            <option>Iron Condor</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('newOptionModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Confirmar Opção</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Configurações dos contratos
        const CONTRACT_SIZES = {
            BGI: { size: 330, unit: 'arrobas', name: 'Boi Gordo' },
            CCM: { size: 450, unit: 'sacos', name: 'Milho' }
        };
        
        // Funções de cálculo LONG/SHORT
        function calculatePositionPnL(position) {
            const { direction, quantity, entryPrice, currentPrice, contractSize } = position;
            
            // Quantidade total (contratos * tamanho)
            const totalQuantity = quantity * contractSize;
            
            // Diferença de preço
            const priceDiff = currentPrice - entryPrice;
            
            // P&L baseado na direção
            // IMPORTANTE: 
            // - LONG (Compra): Ganha quando o preço SOBE, perde quando CAI
            // - SHORT (Venda): Ganha quando o preço CAI, perde quando SOBE
            let pnl = 0;
            if (direction === 'LONG') {
                // LONG: P&L = (Preço Atual - Preço Entrada) * Quantidade Total
                pnl = priceDiff * totalQuantity;
            } else {
                // SHORT: P&L = (Preço Entrada - Preço Atual) * Quantidade Total
                // Ou seja: -(Preço Atual - Preço Entrada) * Quantidade Total
                pnl = -priceDiff * totalQuantity;
            }
            
            // Exposição (valor nocional da posição)
            const exposure = entryPrice * totalQuantity;
            
            // P&L percentual
            const pnlPercentage = exposure > 0 ? (pnl / exposure) * 100 : 0;
            
            return {
                pnl,
                pnlPercentage,
                totalQuantity,
                exposure,
                priceDiff
            };
        }
        
        // Calcula preço alvo para determinado P&L
        function calculateTargetPrice(position, targetPnL) {
            const { direction, entryPrice, quantity, contractSize } = position;
            const totalQuantity = quantity * contractSize;
            
            if (direction === 'LONG') {
                // Para LONG: targetPrice = entryPrice + (targetPnL / totalQuantity)
                return entryPrice + (targetPnL / totalQuantity);
            } else {
                // Para SHORT: targetPrice = entryPrice - (targetPnL / totalQuantity)
                return entryPrice - (targetPnL / totalQuantity);
            }
        }
        
        // Sistema de navegação
        function showPage(pageId, element) {
            // Esconder todas as páginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostrar página selecionada
            document.getElementById(pageId).classList.add('active');
            
            // Atualizar menu ativo
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            
            // Fechar sidebar no mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
            
            // Inicializar gráficos da página se necessário
            if (pageId === 'rentabilidade') {
                setTimeout(initRentabilidadeCharts, 100);
            } else if (pageId === 'posicoes') {
                setTimeout(initPosicoesCharts, 100);
            } else if (pageId === 'opcoes') {
                setTimeout(initOpcoesCharts, 100);
            }
        }
        
        // Toggle sidebar mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        
        // Sistema de tema
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            updateThemeToggle(newTheme);
            
            // Recriar gráficos se existirem
            if (window.capitalChart) {
                initRentabilidadeCharts();
            }
            if (window.capitalDistChart) {
                initPosicoesCharts();
            }
            if (window.payoffChart) {
                initOpcoesCharts();
            }
        }
        
        function updateThemeToggle(theme) {
            const darkOption = document.getElementById('darkMode');
            const lightOption = document.getElementById('lightMode');
            
            if (theme === 'light') {
                darkOption.classList.remove('active');
                lightOption.classList.add('active');
            } else {
                darkOption.classList.add('active');
                lightOption.classList.remove('active');
            }
        }
        
        // Tabs de posições
        function showPositionTab(tabId, element) {
            // Esconder todas as tabs
            document.querySelectorAll('.position-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Mostrar tab selecionada
            document.getElementById('posicoes-' + tabId).style.display = 'block';
            
            // Atualizar estado visual das tabs
            document.querySelectorAll('#posicoes .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            element.classList.add('active');
            
            // Inicializar gráficos específicos da tab
            if (tabId === 'performance' || tabId === 'resumo') {
                setTimeout(initPosicoesCharts, 100);
            }
        }
        
        // Tabs de opções
        function showOptionTab(tabId, element) {
            // Esconder todas as tabs
            document.querySelectorAll('.option-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Mostrar tab selecionada
            document.getElementById('opcoes-' + tabId).style.display = 'block';
            
            // Atualizar estado visual das tabs
            document.querySelectorAll('#opcoes .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            element.classList.add('active');
            
            if (tabId === 'payoff') {
                setTimeout(initOpcoesCharts, 100);
            }
        }
        
        // Modal functions
        function openNewPositionModal() {
            document.getElementById('newPositionModal').classList.add('active');
            updatePositionPreview();
        }
        
        function openNewOptionModal() {
            document.getElementById('newOptionModal').classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Limpar formulário
            if (modalId === 'newPositionModal') {
                document.getElementById('quantity').value = 1;
                document.getElementById('price').value = '';
                document.getElementById('stopLoss').value = '';
                document.getElementById('takeProfit').value = '';
                document.getElementById('positionPreview').style.display = 'none';
            }
        }
        
        // Atualiza preview da posição
        function updatePositionPreview() {
            const contractType = document.getElementById('contractType').value;
            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            const priceStr = document.getElementById('price').value.replace('R
        
        // Funções para gerenciar posições
        function closePosition(positionId, currentPrice) {
            if (confirm(`Deseja fechar a posição ${positionId} ao preço atual de R$ ${currentPrice}?`)) {
                // Aqui você implementaria a lógica para fechar a posição
                console.log(`Fechando posição ${positionId} a R$ ${currentPrice}`);
                
                // Exemplo de cálculo do resultado final
                // Você pegaria os dados reais da posição do banco/estado
                const mockPosition = {
                    direction: positionId.includes('BGI') ? 'LONG' : 'SHORT',
                    quantity: positionId.includes('BGI') ? 10 : 15,
                    entryPrice: positionId.includes('BGI') ? 330 : 85,
                    currentPrice: currentPrice,
                    contractSize: positionId.includes('BGI') ? 330 : 450
                };
                
                const result = calculatePositionPnL(mockPosition);
                
                alert(`Posição fechada!\nResultado: ${result.pnl >= 0 ? '+' : ''}R$ ${result.pnl.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`);
            }
        }
        
        function editPosition(positionId) {
            // Abrir modal de edição ou permitir edição inline
            console.log(`Editando posição ${positionId}`);
            alert(`Funcionalidade de edição para ${positionId} em desenvolvimento`);
        }
        
        // Formatação de moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }
        
        // Função para obter cores do tema
        function getChartColors() {
            const theme = document.documentElement.getAttribute('data-theme');
            const styles = getComputedStyle(document.documentElement);
            
            return {
                textColor: styles.getPropertyValue('--text-secondary').trim(),
                gridColor: styles.getPropertyValue('--border-color').trim(),
                positiveColor: styles.getPropertyValue('--color-positive').trim(),
                negativeColor: styles.getPropertyValue('--color-negative').trim(),
                infoColor: styles.getPropertyValue('--color-info').trim(),
                warningColor: styles.getPropertyValue('--color-warning').trim(),
                bgPrimary: styles.getPropertyValue('--bg-primary').trim()
            };
        }
        
        // Gráficos de Rentabilidade
        let capitalChart = null;
        let plByContractChart = null;
        
        function initRentabilidadeCharts() {
            const colors = getChartColors();
            
            // Destruir gráficos existentes
            if (capitalChart) capitalChart.destroy();
            if (plByContractChart) plByContractChart.destroy();
            
            // Gráfico de evolução do capital
            const capitalCtx = document.getElementById('capitalEvolutionChart');
            if (capitalCtx) {
                capitalChart = new Chart(capitalCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul'],
                        datasets: [{
                            label: 'Capital Total',
                            data: [200000, 195500, 203700, 208900, 218000, 235000, 245780],
                            borderColor: colors.infoColor,
                            backgroundColor: colors.infoColor + '20',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return 'Capital: R$ ' + context.parsed.y.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false, color: colors.gridColor },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico P&L por contrato
            const plCtx = document.getElementById('plByContractChart');
            if (plCtx) {
                plByContractChart = new Chart(plCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['BGI', 'CCM', 'ICF', 'DOL', 'IND'],
                        datasets: [{
                            label: 'P&L',
                            data: [18500, 12300, -4200, 8900, 10280],
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor : colors.negativeColor;
                            },
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const prefix = value >= 0 ? '+' : '';
                                        return 'P&L: ' + prefix + 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false, color: colors.gridColor },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        const prefix = value >= 0 ? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar tema salvo
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
            
            // Inicializar gráficos da página inicial
            setTimeout(initRentabilidadeCharts, 100);
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(function(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        });
    </script>? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Gráficos de Posições
        let capitalDistChart = null;
        let positionPLChart = null;
        let closedPositionsChart = null;
        let contractComparisonChart = null;
        
        function initPosicoesCharts() {
            const colors = getChartColors();
            
            // Destruir gráficos existentes
            if (capitalDistChart) capitalDistChart.destroy();
            if (positionPLChart) positionPLChart.destroy();
            if (closedPositionsChart) closedPositionsChart.destroy();
            if (contractComparisonChart) contractComparisonChart.destroy();
            
            // Gráfico de distribuição de capital
            const distCtx = document.getElementById('capitalDistributionChart');
            if (distCtx) {
                capitalDistChart = new Chart(distCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['BGI', 'CCM', 'ICF', 'Caixa'],
                        datasets: [{
                            data: [45, 30, 15, 10],
                            backgroundColor: [
                                colors.infoColor,
                                colors.positiveColor,
                                colors.warningColor,
                                colors.gridColor
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: colors.textColor,
                                    padding: 15,
                                    font: { size: 13 }
                                }
                            },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico P&L por posição
            const plPosCtx = document.getElementById('positionPLChart');
            if (plPosCtx) {
                positionPLChart = new Chart(plPosCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['BGIK25', 'BGIU25', 'CCMK25', 'CCMN25', 'BGIZ25'],
                        datasets: [{
                            label: 'P&L',
                            data: [18150, 12300, -8100, -3200, 5400],
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor : colors.negativeColor;
                            },
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { color: colors.textColor }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de posições fechadas
            const closedCtx = document.getElementById('closedPositionsChart');
            if (closedCtx) {
                closedPositionsChart = new Chart(closedCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['01/Jul', '05/Jul', '10/Jul', '15/Jul', '19/Jul'],
                        datasets: [{
                            label: 'P&L Acumulado',
                            data: [0, 4200, 8500, 6700, 10050],
                            borderColor: colors.positiveColor,
                            backgroundColor: colors.positiveColor + '20',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de comparação de contratos
            const compCtx = document.getElementById('contractComparisonChart');
            if (compCtx) {
                contractComparisonChart = new Chart(compCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: ['Volume', 'P&L', 'Win Rate', 'Risco', 'Exposição'],
                        datasets: [{
                            label: 'BGI',
                            data: [85, 75, 68, 45, 60],
                            borderColor: colors.infoColor,
                            backgroundColor: colors.infoColor + '20',
                            pointBackgroundColor: colors.infoColor
                        }, {
                            label: 'CCM',
                            data: [65, 55, 72, 35, 40],
                            borderColor: colors.positiveColor,
                            backgroundColor: colors.positiveColor + '20',
                            pointBackgroundColor: colors.positiveColor
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    color: colors.textColor,
                                    backdropColor: 'transparent'
                                },
                                grid: {
                                    color: colors.gridColor
                                },
                                pointLabels: {
                                    color: colors.textColor,
                                    font: { size: 12 }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: colors.textColor,
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Gráficos de Opções
        let payoffChart = null;
        
        function initOpcoesCharts() {
            const colors = getChartColors();
            
            if (payoffChart) payoffChart.destroy();
            
            const payoffCtx = document.getElementById('payoffChart');
            if (payoffCtx) {
                // Simular dados de payoff para um Bull Call Spread
                const strikes = [];
                const payoffData = [];
                const underlyngPrice = 330;
                const callLongStrike = 330;
                const callShortStrike = 340;
                const premium = 2.5;
                
                for (let price = 300; price <= 360; price += 2) {
                    strikes.push(price);
                    let payoff = 0;
                    
                    if (price <= callLongStrike) {
                        payoff = -premium * 330; // Perda do prêmio
                    } else if (price >= callShortStrike) {
                        payoff = ((callShortStrike - callLongStrike) - premium) * 330;
                    } else {
                        payoff = ((price - callLongStrike) - premium) * 330;
                    }
                    
                    payoffData.push(payoff);
                }
                
                payoffChart = new Chart(payoffCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: strikes,
                        datasets: [{
                            label: 'Payoff na Expiração',
                            data: payoffData,
                            borderColor: colors.infoColor,
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor + '20' : colors.negativeColor + '20';
                            },
                            borderWidth: 2,
                            fill: true,
                            tension: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const prefix = value >= 0 ? '+' : '';
                                        return 'P&L: ' + prefix + 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Preço do Ativo Base',
                                    color: colors.textColor
                                },
                                grid: { color: colors.gridColor },
                                ticks: { 
                                    color: colors.textColor,
                                    callback: function(value, index) {
                                        return 'R$ ' + this.getLabelForValue(value);
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Lucro/Prejuízo',
                                    color: colors.textColor
                                },
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        const prefix = value >= 0 ? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar tema salvo
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
            
            // Inicializar gráficos da página inicial
            setTimeout(initRentabilidadeCharts, 100);
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        });
    </script>
</body>
</html>
                , '').replace(',', '.');
            const price = parseFloat(priceStr) || 0;
            const direction = document.getElementById('direction').value;
            
            if (quantity > 0 && price > 0) {
                const contract = CONTRACT_SIZES[contractType];
                const position = {
                    direction,
                    quantity,
                    entryPrice: price,
                    currentPrice: price,
                    contractSize: contract.size
                };
                
                const calc = calculatePositionPnL(position);
                
                // Atualiza valores do preview
                document.getElementById('previewQuantity').textContent = 
                    `${calc.totalQuantity.toLocaleString('pt-BR')} ${contract.unit}`;
                document.getElementById('previewExposure').textContent = 
                    `R$ ${calc.exposure.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                
                // Cenários de lucro/prejuízo (5%)
                const profit5 = calculateTargetPrice(position, calc.exposure * 0.05);
                const loss5 = calculateTargetPrice(position, -calc.exposure * 0.05);
                
                if (direction === 'LONG') {
                    document.getElementById('profitDirection').textContent = 'subir para';
                    document.getElementById('lossDirection').textContent = 'cair para';
                } else {
                    document.getElementById('profitDirection').textContent = 'cair para';
                    document.getElementById('lossDirection').textContent = 'subir para';
                }
                
                document.getElementById('previewProfit').textContent = 
                    `R$ ${profit5.toFixed(2)} (+5%)`;
                document.getElementById('previewLoss').textContent = 
                    `R$ ${loss5.toFixed(2)} (-5%)`;
                
                document.getElementById('positionPreview').style.display = 'block';
                
                // Atualiza texto do botão
                document.getElementById('submitButtonText').textContent = 
                    direction === 'LONG' ? 'Confirmar Compra' : 'Confirmar Venda';
            } else {
                document.getElementById('positionPreview').style.display = 'none';
            }
        }
        
        // Manipula nova posição
        function handleNewPosition(event) {
            event.preventDefault();
            
            const contractType = document.getElementById('contractType').value;
            const contractMonth = document.getElementById('contractMonth').value;
            const direction = document.getElementById('direction').value;
            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            const priceStr = document.getElementById('price').value.replace('R
        
        // Função para obter cores do tema
        function getChartColors() {
            const theme = document.documentElement.getAttribute('data-theme');
            const styles = getComputedStyle(document.documentElement);
            
            return {
                textColor: styles.getPropertyValue('--text-secondary').trim(),
                gridColor: styles.getPropertyValue('--border-color').trim(),
                positiveColor: styles.getPropertyValue('--color-positive').trim(),
                negativeColor: styles.getPropertyValue('--color-negative').trim(),
                infoColor: styles.getPropertyValue('--color-info').trim(),
                warningColor: styles.getPropertyValue('--color-warning').trim(),
                bgPrimary: styles.getPropertyValue('--bg-primary').trim()
            };
        }
        
        // Gráficos de Rentabilidade
        let capitalChart = null;
        let plByContractChart = null;
        
        function initRentabilidadeCharts() {
            const colors = getChartColors();
            
            // Destruir gráficos existentes
            if (capitalChart) capitalChart.destroy();
            if (plByContractChart) plByContractChart.destroy();
            
            // Gráfico de evolução do capital
            const capitalCtx = document.getElementById('capitalEvolutionChart');
            if (capitalCtx) {
                capitalChart = new Chart(capitalCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul'],
                        datasets: [{
                            label: 'Capital Total',
                            data: [200000, 195500, 203700, 208900, 218000, 235000, 245780],
                            borderColor: colors.infoColor,
                            backgroundColor: colors.infoColor + '20',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return 'Capital: R$ ' + context.parsed.y.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false, color: colors.gridColor },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico P&L por contrato
            const plCtx = document.getElementById('plByContractChart');
            if (plCtx) {
                plByContractChart = new Chart(plCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['BGI', 'CCM', 'ICF', 'DOL', 'IND'],
                        datasets: [{
                            label: 'P&L',
                            data: [18500, 12300, -4200, 8900, 10280],
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor : colors.negativeColor;
                            },
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const prefix = value >= 0 ? '+' : '';
                                        return 'P&L: ' + prefix + 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false, color: colors.gridColor },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        const prefix = value >= 0 ? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Gráficos de Posições
        let capitalDistChart = null;
        let positionPLChart = null;
        let closedPositionsChart = null;
        let contractComparisonChart = null;
        
        function initPosicoesCharts() {
            const colors = getChartColors();
            
            // Destruir gráficos existentes
            if (capitalDistChart) capitalDistChart.destroy();
            if (positionPLChart) positionPLChart.destroy();
            if (closedPositionsChart) closedPositionsChart.destroy();
            if (contractComparisonChart) contractComparisonChart.destroy();
            
            // Gráfico de distribuição de capital
            const distCtx = document.getElementById('capitalDistributionChart');
            if (distCtx) {
                capitalDistChart = new Chart(distCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['BGI', 'CCM', 'ICF', 'Caixa'],
                        datasets: [{
                            data: [45, 30, 15, 10],
                            backgroundColor: [
                                colors.infoColor,
                                colors.positiveColor,
                                colors.warningColor,
                                colors.gridColor
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: colors.textColor,
                                    padding: 15,
                                    font: { size: 13 }
                                }
                            },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico P&L por posição
            const plPosCtx = document.getElementById('positionPLChart');
            if (plPosCtx) {
                positionPLChart = new Chart(plPosCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['BGIK25', 'BGIU25', 'CCMK25', 'CCMN25', 'BGIZ25'],
                        datasets: [{
                            label: 'P&L',
                            data: [18150, 12300, -8100, -3200, 5400],
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor : colors.negativeColor;
                            },
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { color: colors.textColor }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de posições fechadas
            const closedCtx = document.getElementById('closedPositionsChart');
            if (closedCtx) {
                closedPositionsChart = new Chart(closedCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['01/Jul', '05/Jul', '10/Jul', '15/Jul', '19/Jul'],
                        datasets: [{
                            label: 'P&L Acumulado',
                            data: [0, 4200, 8500, 6700, 10050],
                            borderColor: colors.positiveColor,
                            backgroundColor: colors.positiveColor + '20',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de comparação de contratos
            const compCtx = document.getElementById('contractComparisonChart');
            if (compCtx) {
                contractComparisonChart = new Chart(compCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: ['Volume', 'P&L', 'Win Rate', 'Risco', 'Exposição'],
                        datasets: [{
                            label: 'BGI',
                            data: [85, 75, 68, 45, 60],
                            borderColor: colors.infoColor,
                            backgroundColor: colors.infoColor + '20',
                            pointBackgroundColor: colors.infoColor
                        }, {
                            label: 'CCM',
                            data: [65, 55, 72, 35, 40],
                            borderColor: colors.positiveColor,
                            backgroundColor: colors.positiveColor + '20',
                            pointBackgroundColor: colors.positiveColor
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    color: colors.textColor,
                                    backdropColor: 'transparent'
                                },
                                grid: {
                                    color: colors.gridColor
                                },
                                pointLabels: {
                                    color: colors.textColor,
                                    font: { size: 12 }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: colors.textColor,
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Gráficos de Opções
        let payoffChart = null;
        
        function initOpcoesCharts() {
            const colors = getChartColors();
            
            if (payoffChart) payoffChart.destroy();
            
            const payoffCtx = document.getElementById('payoffChart');
            if (payoffCtx) {
                // Simular dados de payoff para um Bull Call Spread
                const strikes = [];
                const payoffData = [];
                const underlyngPrice = 330;
                const callLongStrike = 330;
                const callShortStrike = 340;
                const premium = 2.5;
                
                for (let price = 300; price <= 360; price += 2) {
                    strikes.push(price);
                    let payoff = 0;
                    
                    if (price <= callLongStrike) {
                        payoff = -premium * 330; // Perda do prêmio
                    } else if (price >= callShortStrike) {
                        payoff = ((callShortStrike - callLongStrike) - premium) * 330;
                    } else {
                        payoff = ((price - callLongStrike) - premium) * 330;
                    }
                    
                    payoffData.push(payoff);
                }
                
                payoffChart = new Chart(payoffCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: strikes,
                        datasets: [{
                            label: 'Payoff na Expiração',
                            data: payoffData,
                            borderColor: colors.infoColor,
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor + '20' : colors.negativeColor + '20';
                            },
                            borderWidth: 2,
                            fill: true,
                            tension: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const prefix = value >= 0 ? '+' : '';
                                        return 'P&L: ' + prefix + 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Preço do Ativo Base',
                                    color: colors.textColor
                                },
                                grid: { color: colors.gridColor },
                                ticks: { 
                                    color: colors.textColor,
                                    callback: function(value, index) {
                                        return 'R$ ' + this.getLabelForValue(value);
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Lucro/Prejuízo',
                                    color: colors.textColor
                                },
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        const prefix = value >= 0 ? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar tema salvo
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
            
            // Inicializar gráficos da página inicial
            setTimeout(initRentabilidadeCharts, 100);
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        });
    </script>
</body>
</html>
                , '').replace(',', '.');
            const price = parseFloat(priceStr) || 0;
            
            if (quantity > 0 && price > 0) {
                // Aqui você adicionaria a lógica para salvar a posição
                console.log('Nova posição:', {
                    contract: contractType + contractMonth + '25',
                    direction,
                    quantity,
                    price,
                    contractSize: CONTRACT_SIZES[contractType].size
                });
                
                // Fecha o modal
                closeModal('newPositionModal');
                
                // Mostra mensagem de sucesso (opcional)
                alert(`Posição ${direction} criada com sucesso!`);
            }
        }
        
        // Funções para os botões de ação
        function closeAllPositions() {
            if (confirm('Tem certeza que deseja fechar todas as posições abertas?')) {
                // Aqui você implementaria a lógica para fechar todas as posições
                console.log('Fechando todas as posições...');
                
                // Simula fechamento
                const positions = document.querySelectorAll('.position-row');
                positions.forEach(row => {
                    // Adicionar lógica de fechamento
                });
                
                alert('Todas as posições foram fechadas!');
            }
        }
        
        function autoHedge() {
            // Calcula hedge automático baseado nas posições abertas
            const hedgeModal = confirm('Deseja criar posições de hedge automático para proteger seu portfólio?');
            
            if (hedgeModal) {
                // Aqui você implementaria a lógica de hedge
                console.log('Calculando hedge automático...');
                
                // Exemplo: para cada posição LONG, criar uma opção PUT
                // Para cada posição SHORT, criar uma opção CALL
                
                alert('Hedge automático configurado com sucesso!');
            }
        }
        
        // Função para obter cores do tema
        function getChartColors() {
            const theme = document.documentElement.getAttribute('data-theme');
            const styles = getComputedStyle(document.documentElement);
            
            return {
                textColor: styles.getPropertyValue('--text-secondary').trim(),
                gridColor: styles.getPropertyValue('--border-color').trim(),
                positiveColor: styles.getPropertyValue('--color-positive').trim(),
                negativeColor: styles.getPropertyValue('--color-negative').trim(),
                infoColor: styles.getPropertyValue('--color-info').trim(),
                warningColor: styles.getPropertyValue('--color-warning').trim(),
                bgPrimary: styles.getPropertyValue('--bg-primary').trim()
            };
        }
        
        // Gráficos de Rentabilidade
        let capitalChart = null;
        let plByContractChart = null;
        
        function initRentabilidadeCharts() {
            const colors = getChartColors();
            
            // Destruir gráficos existentes
            if (capitalChart) capitalChart.destroy();
            if (plByContractChart) plByContractChart.destroy();
            
            // Gráfico de evolução do capital
            const capitalCtx = document.getElementById('capitalEvolutionChart');
            if (capitalCtx) {
                capitalChart = new Chart(capitalCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul'],
                        datasets: [{
                            label: 'Capital Total',
                            data: [200000, 195500, 203700, 208900, 218000, 235000, 245780],
                            borderColor: colors.infoColor,
                            backgroundColor: colors.infoColor + '20',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return 'Capital: R$ ' + context.parsed.y.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false, color: colors.gridColor },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico P&L por contrato
            const plCtx = document.getElementById('plByContractChart');
            if (plCtx) {
                plByContractChart = new Chart(plCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['BGI', 'CCM', 'ICF', 'DOL', 'IND'],
                        datasets: [{
                            label: 'P&L',
                            data: [18500, 12300, -4200, 8900, 10280],
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor : colors.negativeColor;
                            },
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const prefix = value >= 0 ? '+' : '';
                                        return 'P&L: ' + prefix + 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false, color: colors.gridColor },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        const prefix = value >= 0 ? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Gráficos de Posições
        let capitalDistChart = null;
        let positionPLChart = null;
        let closedPositionsChart = null;
        let contractComparisonChart = null;
        
        function initPosicoesCharts() {
            const colors = getChartColors();
            
            // Destruir gráficos existentes
            if (capitalDistChart) capitalDistChart.destroy();
            if (positionPLChart) positionPLChart.destroy();
            if (closedPositionsChart) closedPositionsChart.destroy();
            if (contractComparisonChart) contractComparisonChart.destroy();
            
            // Gráfico de distribuição de capital
            const distCtx = document.getElementById('capitalDistributionChart');
            if (distCtx) {
                capitalDistChart = new Chart(distCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['BGI', 'CCM', 'ICF', 'Caixa'],
                        datasets: [{
                            data: [45, 30, 15, 10],
                            backgroundColor: [
                                colors.infoColor,
                                colors.positiveColor,
                                colors.warningColor,
                                colors.gridColor
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: colors.textColor,
                                    padding: 15,
                                    font: { size: 13 }
                                }
                            },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico P&L por posição
            const plPosCtx = document.getElementById('positionPLChart');
            if (plPosCtx) {
                positionPLChart = new Chart(plPosCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['BGIK25', 'BGIU25', 'CCMK25', 'CCMN25', 'BGIZ25'],
                        datasets: [{
                            label: 'P&L',
                            data: [18150, 12300, -8100, -3200, 5400],
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor : colors.negativeColor;
                            },
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                padding: 12
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { color: colors.textColor }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de posições fechadas
            const closedCtx = document.getElementById('closedPositionsChart');
            if (closedCtx) {
                closedPositionsChart = new Chart(closedCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['01/Jul', '05/Jul', '10/Jul', '15/Jul', '19/Jul'],
                        datasets: [{
                            label: 'P&L Acumulado',
                            data: [0, 4200, 8500, 6700, 10050],
                            borderColor: colors.positiveColor,
                            backgroundColor: colors.positiveColor + '20',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { color: colors.textColor }
                            },
                            y: {
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de comparação de contratos
            const compCtx = document.getElementById('contractComparisonChart');
            if (compCtx) {
                contractComparisonChart = new Chart(compCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: ['Volume', 'P&L', 'Win Rate', 'Risco', 'Exposição'],
                        datasets: [{
                            label: 'BGI',
                            data: [85, 75, 68, 45, 60],
                            borderColor: colors.infoColor,
                            backgroundColor: colors.infoColor + '20',
                            pointBackgroundColor: colors.infoColor
                        }, {
                            label: 'CCM',
                            data: [65, 55, 72, 35, 40],
                            borderColor: colors.positiveColor,
                            backgroundColor: colors.positiveColor + '20',
                            pointBackgroundColor: colors.positiveColor
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    color: colors.textColor,
                                    backdropColor: 'transparent'
                                },
                                grid: {
                                    color: colors.gridColor
                                },
                                pointLabels: {
                                    color: colors.textColor,
                                    font: { size: 12 }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: colors.textColor,
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Gráficos de Opções
        let payoffChart = null;
        
        function initOpcoesCharts() {
            const colors = getChartColors();
            
            if (payoffChart) payoffChart.destroy();
            
            const payoffCtx = document.getElementById('payoffChart');
            if (payoffCtx) {
                // Simular dados de payoff para um Bull Call Spread
                const strikes = [];
                const payoffData = [];
                const underlyngPrice = 330;
                const callLongStrike = 330;
                const callShortStrike = 340;
                const premium = 2.5;
                
                for (let price = 300; price <= 360; price += 2) {
                    strikes.push(price);
                    let payoff = 0;
                    
                    if (price <= callLongStrike) {
                        payoff = -premium * 330; // Perda do prêmio
                    } else if (price >= callShortStrike) {
                        payoff = ((callShortStrike - callLongStrike) - premium) * 330;
                    } else {
                        payoff = ((price - callLongStrike) - premium) * 330;
                    }
                    
                    payoffData.push(payoff);
                }
                
                payoffChart = new Chart(payoffCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: strikes,
                        datasets: [{
                            label: 'Payoff na Expiração',
                            data: payoffData,
                            borderColor: colors.infoColor,
                            backgroundColor: function(context) {
                                const value = context.raw;
                                return value >= 0 ? colors.positiveColor + '20' : colors.negativeColor + '20';
                            },
                            borderWidth: 2,
                            fill: true,
                            tension: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.bgPrimary,
                                borderColor: colors.gridColor,
                                borderWidth: 1,
                                titleColor: colors.textColor,
                                bodyColor: colors.textColor,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const prefix = value >= 0 ? '+' : '';
                                        return 'P&L: ' + prefix + 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Preço do Ativo Base',
                                    color: colors.textColor
                                },
                                grid: { color: colors.gridColor },
                                ticks: { 
                                    color: colors.textColor,
                                    callback: function(value, index) {
                                        return 'R$ ' + this.getLabelForValue(value);
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Lucro/Prejuízo',
                                    color: colors.textColor
                                },
                                grid: { color: colors.gridColor },
                                ticks: {
                                    color: colors.textColor,
                                    callback: function(value) {
                                        const prefix = value >= 0 ? '+' : '';
                                        return prefix + 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar tema salvo
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
            
            // Inicializar gráficos da página inicial
            setTimeout(initRentabilidadeCharts, 100);
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        });
    </script>
</body>
</html>
                